{{ define "custom_meta" }}
<!-- Pagination meta tags for list pages only -->
{{ $paginator := .Paginate (where .Pages "Section" "blog") }}
{{ if $paginator }}
<link rel="first" href="{{ $paginator.First.URL }}">
<link rel="last" href="{{ $paginator.Last.URL }}">
{{ if $paginator.HasPrev }}
<link rel="prev" href="{{ $paginator.Prev.URL }}">
{{end }}
{{ if $paginator.HasNext }}
<link rel="next" href="{{ $paginator.Next.URL }}">
{{end }}
{{end }}

<meta property="og:type" content="article" />
<meta property="article:publisher" content="{{ .Site.Params.facebook }}" /> 
<meta property="og:article:published_time" content={{ .Date.Format "2006-01-02T15:04:05Z0700" | safeHTML }} /> 
<meta property="article:published_time" content={{ .Date.Format "2006-01-02T15:04:05Z0700" | safeHTML }} />
  
{{ with.Params.author }} 
<meta property="og:article:author" content="{{humanize . }}" />
<meta property="article:author" content="{{humanize . }}" /> 
<meta name="author" content="{{humanize . }}" /> 
{{ end }}
  
{{ with.Params.category }} 
<meta name="news_keywords" content="{{ index . 0 }}" />
<meta property="article:section" content="{{ index . 0 }}" /> 
{{ end }}

<script defer type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Article",
      "headline": {{ .Title }},
      "author": {
        "@type": "Person",
        "name": "{{ .Site.Params.github }}"
      },
      "datePublished": "{{ .Date.Format "2006-01-02" }}",
      "description": {{ .Description }},
      "wordCount": {{ .WordCount }},
      "mainEntityOfPage": "True",
      "dateModified": "{{ .Lastmod.Format "2006-01-02" }}",
      "image": {
        "@type": "imageObject",
        "url": "{{ with .Params.image }}{{ .Permalink }}{{ end }}"
      },
      "publisher": {
        "@type": "Organization",
        "name": "{{ .Site.Title }}",
        "logo": {
          "@type": "imageObject",
          "url": "https://www.example.com/images/brand/favicon.png"
        }
      }
    }
</script>
{{ end }}
{{ end }}

{{ define "custom_css" }}
    {{- with resources.Get "/asset/css/leaflet/leaflet.css" -}}
    {{ $style := . | minify | fingerprint -}}
    <link rel="stylesheet" href={{ $style.RelPermalink }}>
    {{ end -}}
{{ end }}

{{ define "main" }}
<section class="w-100">
    <header class="ph3 ph5-ns pv2">
        <div class="mw8 center">
            <!-- p class="f6 tracked ttu lh-title black-50">(#SURTITRE**)</p --> 
            <h1 class="f3 tracked ttu lh-title"><a class="link black-80" href={{ .CurrentSection.RelPermalink }}>{{- .CurrentSection.Title }} - </a>{{ .Title -}}</h1>
            <!-- p class="f5 f4-ns tracked ttu lh-title black-50">(#SOUSTITRE**)</p -->
            <div class="flex flex-wrap">
                {{ with .Resources.GetMatch "logo*.jpg" }}
                {{ if eq .Title "logo_large.jpg" }}
                {{ $logo := .Fill "880x300" }}
                <div class="w-100">
                    <img src={{ $logo.RelPermalink }} class="db w-100 h-auto br4">
                </div>
                {{ else }}
                {{ $logo := .Fill "300x300" }}
                <div class="w-30 w-20-ns">
                    <img src={{ $logo.RelPermalink }} class="db w-100 h-auto br4">
                {{ end -}}
                </div>
                {{ end -}}

                <div class="w-70 w-80-ns pa2">
                    <div class="mt1">
                        {{ with .Keywords }}
                        <div class="pa2">
                            <i class="fas fa-hashtag"></i>
                            {{ range $index, $e := . -}}
                            {{- if $index }} | {{ end }}
                            <a class="black-80" href="." title="{{ . }}">{{ . }}</a>
                            {{- end -}}
                        </div>
                        {{ end -}}
                        <div class="pa2">
                            <p><i class="fas fa-user-clock"></i> Tempo di lettura {{ .ReadingTime }} minut{{ if eq .ReadingTime 1 }}o{{else}}i{{ end }}</p>
                        </div>
                        <!-- div class="pa2">
                            <i class="fas fa-at"></i> <BOUCLE_autori(AUTEURS){id_article}{" | "}><a class="black-80" href="#URL_AUTEUR">#NOM</a></BOUCLE_autori>
                        </div -->
                        <!-- div class="pa2">
                            <i class="fas fa-link"></i> <a class="black-80" href="(#URL_SITE)">[(#NOM_SITE|sinon{[(#URL_SITE|couper{80})]})]</a>
                        </div -->
                        <div class="pa2">
                            <p class="f6 black-50 tracked">pubblicato il <time class="f5 fw4 mt2 black-60" datetime={{ .Date.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}>
                                {{ humanize (index $.Site.Data.mesi (printf "%d" .Date.Month)) }} {{ .Date.Year }}
                            </time>
                            {{ if or (ne .Date.Month .Lastmod.Month) (ne .Date.Year .Lastmod.Year) -}}
                            &mdash; modificato il <time class="f5 fw4 mt2 black-60" datetime={{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}>
                                {{ humanize (index $.Site.Data.mesi (printf "%d" .Lastmod.Month)) }} {{ .Lastmod.Year }}
                            </time>
                            {{ end -}}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
</section>

<section class="w-100">
    <article class="ph3 ph5-ns pv2">
        <div class="mw8 center">
            <div class="f5 f4-ns cf lh-copy">
                {{ with .Params.diga -}}
                    {{ partial "diga.html" . -}}
                {{ end -}}
                {{ with .Params.coords -}}
                    {{ partial "mappa.html" . -}}
                {{ end -}}
                <div id="mapid"></div>
                {{ .Content }}
            </div>
        </div>
    </article>
</section>

<section class="w-100">
    <article class="ph3 ph5-ns pv2">
        <div class="mw8 center">            
            {{ with .Resources.ByType "image" -}}
            <h3 class="f3 tracked ttu lh-title">Immagini</h3>
            {{ range . -}}
            <a data-fslightbox class="link black-80" href={{ .RelPermalink }} rel="img_portfolio" type="{{ .MediaType.Type }}">
                {{ $image := .Fill "100x100" -}}
                <img src={{ $image.RelPermalink }} width={{$image.Width}} height={{$image.Height}}>
            </a>
            {{ end -}}
            {{ end -}}
            <!-- 
            <B_documenti>
            <h3 class="f3 tracked ttu lh-title">Documenti</h3>
            <BOUCLE_documenti(DOCUMENTS) {id_article} {mode=document} {titre!==^logo\_} {par num titre, date} {doublons}>
            <article class="mw5 bg-white br3 pa3 pa4-ns mv3 ba b--black-10">
                <a class="link dt w-100 bb b--black-10 pb2 mt2 dim blue" href="#URL_DOCUMENT">
                <div class="tc">
                    <img src="[(#LOGO_DOCUMENT|extraire_attribut{src}|url_absolue)]" class="h4 w4 dib ba b--black-05 pa2">
                    [<h1 class="f3 mb2">(#TITRE)</h1>]
                    [<h2 class="f5 fw4 gray mt0">(#DESCRIPTIF)</h2>]
                    <p class="f6 black-50">(#TYPE_DOCUMENT[ - (#TAILLE|taille_en_octets)])</p>
                </div>
                </a>
            </article>
            </BOUCLE_documenti>
            </B_documenti>
            -->
        </div>
    </article>
</section>

<section class="w-100">
    <article class="ph3 ph5-ns pv2">
        <div class="mw8 center">
            {{ template "_internal/disqus.html" . }}
        </div>
    </article>
</section>
{{ end }}

{{ define "footer_scripts" }}
<script type="text/javascript" src={{ "/asset/js/fslightbox/fslightbox.js" | relURL}}></script>
{{ end }}